---
description: Criteria for identifying low-value tests to remove safely
alwaysApply: false
---

# Tests/Feature・Unit の削除判断ルール

目的: 失敗しやすい/重複/保守コストが高いテストを減らしつつ、回帰検知の価値が高いテストは残す。

## Unit テストの追加観点

- **実装詳細テストの過多に注意**
  - private/内部構造に強く依存するテストは削除候補になりやすい。
  - 公開APIや振る舞いを中心にテストする。
- **型・値オブジェクトの単純なゲッター検証**
  - 「コンストラクタで入れた値がそのまま返るだけ」のテストは低価値になりやすい。
  - 例外条件/バリデーション/変換ロジックがない場合は削除候補。
- **境界値・例外系は残す**
  - Unitでもバリデーションや境界値の挙動は残すべき。
- **モック過多のユニットテスト**
  - ほぼモックの検証だけで実装本体が触られない場合、価値が低い。
  - 代わりにFeatureで担保できるなら削除候補。

## 削除候補の判断基準（優先度順）

1. **重複テスト**
   - 同一の成功パス/同一のエラーメッセージ/同一のHTTPコードを別ファイルで繰り返し検証している。
   - 期待値が同じ「JSON形の断片」しか見ていない（例: `assertJson(['error' => ...])`のみ）。

2. **実装依存が強すぎるテスト**
   - 具体的な内部実装の順序・メソッド呼び出し回数のみを検証している。
   - 画面の主要な出力/レスポンス契約ではなく、細かな内部値に過剰に依存している。

3. **外部要因で不安定になるテスト**
   - 外部API、時刻、乱数、ネットワーク、環境依存（Vite/HMRなど）に依存し、安定化が難しい。
   - 安定化できる場合は「削除ではなくスタブ/モック化」を優先。

4. **回帰検知の価値が低いテスト**
   - 単なるカバレッジ目的で、仕様変更に伴う検知価値が低い。
   - 同じ仕様をより高レベル（Feature/Contract）で別テストが担保している。

## 残すべきテスト（削除禁止の目安）

- **ビジネス上重要な経路**
  - 認可/契約判定/料金や同意などの重要フロー
  - 個人情報や機密情報が絡む処理
- **回帰履歴がある箇所**
  - 過去にバグが起きた部分や影響が大きい箇所
- **入力バリデーション・境界値**
  - 仕様として保証したい境界値や必須パラメータ
- **APIのレスポンス契約**
  - クライアントが依存するキー/型/ステータスコード

## 具体的な判断プロセス

1. 削除候補のテストが「何を保証しているか」を1文で要約する。
2. 同じ保証をするテストが他にあるか確認する。
3. 保証対象が仕様書/画面/外部契約に明記されているか確認する。
4. 価値が低い場合は削除、価値が高い場合は改善（安定化/簡素化）する。

## スコアリング（迷ったとき）

各テストに対して以下のスコアを付ける。

- **回帰検知価値**: 高=3 / 中=2 / 低=1
- **保守コスト**: 高=3 / 中=2 / 低=1
- **不安定性**: 高=3 / 中=2 / 低=1
- **重複度**: 高=3 / 中=2 / 低=1

```
削除スコア = (保守コスト + 不安定性 + 重複度) - (回帰検知価値 * 1.5)
```

- **削除スコア >= 4**: 削除候補
- **削除スコア 2〜3**: 改善候補（安定化/簡素化/統合）
- **削除スコア <= 1**: 維持

## 注意事項

- 削除前に「代替テストの存在」を必ず確認する。
- 削除はPR/変更単位で可視化し、理由を簡潔に記録する。
- 迷った場合は「削除せずに改善」を優先する。
